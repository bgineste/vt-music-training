(()=>{"use strict";var e,i={893:()=>{const e=window.wp.blocks,i=window.wp.blockEditor,t=(window.wp.i18n,window.wp.components),n=window.wp.primitives,r=window.ReactJSXRuntime,o=(0,r.jsx)(n.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)(n.Path,{d:"M17 10h-1.2V7c0-2.1-1.7-3.8-3.8-3.8-2.1 0-3.8 1.7-3.8 3.8h1.5c0-1.2 1-2.2 2.2-2.2s2.2 1 2.2 2.2v3H7c-.6 0-1 .4-1 1v8c0 .6.4 1 1 1h10c.6 0 1-.4 1-1v-8c0-.6-.4-1-1-1z"})}),l=(0,r.jsx)(n.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)(n.Path,{d:"M17 10h-1.2V7c0-2.1-1.7-3.8-3.8-3.8-2.1 0-3.8 1.7-3.8 3.8v3H7c-.6 0-1 .4-1 1v8c0 .6.4 1 1 1h10c.6 0 1-.4 1-1v-8c0-.6-.4-1-1-1zm-2.8 0H9.8V7c0-1.2 1-2.2 2.2-2.2s2.2 1 2.2 2.2v3z"})}),s=(0,r.jsx)(n.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)(n.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M5.5 12a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0ZM12 4a8 8 0 1 0 0 16 8 8 0 0 0 0-16Zm.75 4v1.5h-1.5V8h1.5Zm0 8v-5h-1.5v5h1.5Z"})}),a=window.wp.element,c=window.wp.data,u=JSON.parse('{"UU":"vt-music-training/un-fichier-tutti"}');(0,e.registerBlockType)(u.UU,{edit:function(e){console.log("Edit fichier tutti");const n=(0,i.useBlockProps)(),{context:u,attributes:h,setAttributes:d,clientId:p}=e,{"bloc-fichiers-de-travail/cheminFichiers":m}=u,{labelFichierTutti:v,cheminFichierTutti:f,nomFichierTutti:x,typeFichierTutti:g,affichageClavier:w,fichierStereo:j}=h;console.log("appel parent attribute",p);const b=function(e,t){return console.log("Hook Closest parent attribute",e,t),(0,c.useSelect)(n=>{const{getBlockParents:r,getBlockAttributes:o}=n(i.store),l=r(e);console.log("parents",l);for(const e of l){const i=o(e);if(console.log("Parent ID:",e,"Attributes:",i),t in i?console.log(`→ L’attribut ${t} existe avec valeur:`,i[t]):console.log(`→ L’attribut ${t} est absent`),i?.[t])return console.log(`✔ Trouvé ${t} avec valeur:`,i[t]),i[t]}return null},[e,t])}(p,"lyricsPrompter");console.log("TUTTI : PROMPTER",b);const[y,T]=(0,a.useState)(!1),[C,F]=(0,a.useState)(!1);f||d({cheminFichierTutti:m});const k=(0,a.useRef)(),[S,P]=(0,a.useState)(!1),[O,B]=(0,a.useState)(null),D=`${window.location.origin}${f}/${x}`;return(0,r.jsx)("div",{...n,children:e.isSelected?(0,r.jsxs)("div",{children:[(0,r.jsx)(t.TextControl,{label:"Label du fichier 'tutti' (audio ou vidéo)",help:"Par ex.: Video/partition Interprète",value:v,onChange:e=>d({labelFichierTutti:e})}),(0,r.jsx)(t.TextControl,{label:"Chemin du fichier 'tutti'",value:f,onChange:e=>d({cheminFichierTutti:e})}),(0,r.jsxs)(t.Flex,{align:"flex-end",style:{gap:"0.5em",marginBottom:"1em"},children:[(0,r.jsx)(t.FlexItem,{style:{flexGrow:1,position:"relative"},children:(0,r.jsx)(t.TextControl,{label:"Nom du fichier",value:x,readOnly:!y,onChange:e=>d({nomFichierTutti:e})})}),(0,r.jsx)(t.FlexItem,{children:(0,r.jsx)(t.Tooltip,{text:y?"Verrouiller le champ":"Déverrouiller pour modifier",children:(0,r.jsx)(t.IconButton,{icon:y?o:l,label:y?"Verrouiller":"Déverrouiller",onClick:()=>T(!y),isPressed:y})})}),(0,r.jsx)(t.FlexItem,{children:(0,r.jsx)(t.Tooltip,{text:"Aide sur le nom de fichier",children:(0,r.jsx)(t.IconButton,{icon:s,label:"Information sur le nom du fichier",onClick:()=>F(!0),isTertiary:!0})})})]}),C&&(0,r.jsxs)(t.Modal,{title:"Aide sur le nom du fichier",onRequestClose:()=>F(!1),children:[(0,r.jsx)("p",{children:"Le nom du fichier est défini automatiquement après le téléchargement du fichier choisi. Dans la plupart des cas, il n’est pas nécessaire de le modifier."}),(0,r.jsx)("p",{children:"Cependant, vous pouvez exceptionnellement cliquer sur le cadenas pour déverrouiller le champ et saisir un nom personnalisé. (Par exemple, pour indiquer un fichier déjà téléchargé)."}),(0,r.jsx)("div",{style:{textAlign:"right",marginTop:"1em"},children:(0,r.jsx)(t.Button,{variant:"primary",onClick:()=>F(!1),children:"Fermer"})})]}),(0,r.jsxs)("div",{style:{marginTop:"1em"},children:[(0,r.jsx)("label",{className:"label css-2o4jwd",style:{display:"none"},children:x?"Remplacer le fichier":"Choisir un fichier"}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1em"},children:[(0,r.jsx)("button",{type:"button",onClick:()=>k.current.click(),className:"components-button is-secondary",children:x?"Choisir un nouveau fichier":"Choisir un fichier"}),(0,r.jsx)("span",{style:{fontStyle:"italic",fontSize:"1rem"},children:x||"Aucun fichier sélectionné"}),(0,r.jsx)("input",{type:"file",accept:"audio/*,video/*",ref:k,onChange:async e=>{const i=e.target.files[0];if(i){P(!0),B(null);try{if(x){console.log("suppression "+x);const e=await async function(e,i){if(!vtmtData||!vtmtData.nonce)throw new Error("Nonce manquant ou non injecté.");const t=new FormData;t.append("file",e),t.append("chemin",i);const n=await fetch("/wp-json/vt-music-training/v1/supprimer-fichier",{method:"POST",body:t,credentials:"include",headers:{"X-WP-Nonce":vtmtData.nonce}});if(!n.ok){const e=await n.json();throw new Error(e.message||"Erreur lors de la suppression du fichier précédent")}return await n.json()}(x,f);console.log(e.comment)}console.log("file avant uploadFileToServer "+i);const e=await async function(e,i){if(!vtmtData||!vtmtData.nonce)throw new Error("Nonce manquant ou non injecté.");const t=new FormData;t.append("file",e),t.append("chemin",i);const n=await fetch("/wp-json/vt-music-training/v1/upload-fichier",{method:"POST",body:t,credentials:"include",headers:{"X-WP-Nonce":vtmtData.nonce}});if(!n.ok){const e=await n.json();throw new Error(e.message||"Erreur lors de l’upload")}return await n.json()}(i,f);console.log("resultUpload "+e),d({nomFichierTutti:e.nom,cheminFichierTutti:e.chemin}),console.log("Upload "+e.chemin+" - "+e.nom)}catch(e){console.error(e),B(e.message)}finally{P(!1)}}},style:{display:"none"}})]})]}),S&&(0,r.jsx)("p",{children:"📤 Téléversement en cours..."}),O&&(0,r.jsxs)("p",{style:{color:"red"},children:["❌ ",O]}),x&&(0,r.jsxs)("div",{style:{marginTop:"1em",width:"100%",maxWidth:"250px"},children:[(0,r.jsxs)("p",{style:{display:"none"},children:[(0,r.jsx)("strong",{children:"Fichier sélectionné :"})," ",x]}),x.match(/\.(mp3|wav)$/i)&&(0,r.jsx)("audio",{controls:!0,src:D,children:"Votre navigateur ne supporte pas l’audio."}),x.match(/\.(mp4|webm)$/i)&&(0,r.jsx)("video",{controls:!0,src:D,children:"Votre navigateur ne supporte pas la vidéo."}),!x.match(/\.(mp3|wav|mp4|webm)$/i)&&(0,r.jsx)("a",{href:D,target:"_blank",rel:"noopener noreferrer",children:"📄 Ouvrir le fichier"})]}),(0,r.jsx)(t.RadioControl,{label:"Type de fichier",selected:g,options:[{label:"audio",value:"a"},{label:"video",value:"v"}],onChange:e=>d({typeFichierTutti:e})}),(0,r.jsx)(t.ToggleControl,{label:"Afficher le clavier sous le lecteur",checked:w,onChange:e=>d({affichageClavier:e})}),w&&(0,r.jsx)(t.ToggleControl,{label:"Le fichier est stéréo : la voix principale a une piste dédiée",checked:j,onChange:e=>d({fichierStereo:e})})]}):(0,r.jsx)("div",{children:v})})},save:function(e){const t=i.useBlockProps.save(),{attributes:{cheminFichierTutti:n,nomFichierTutti:o,typeFichierTutti:l,labelFichierTutti:s,affichageClavier:a,fichierStereo:c}}=e;return(0,r.jsxs)("div",{...t,className:"vt--un-fichier-tutti","data-chemin":n,"data-nomfichier":o,"data-type":l,"data-clavier":a,"data-stereo":c,children:[(0,r.jsx)("i",{class:"fa-solid fa-square-caret-right"}),(0,r.jsx)("div",{className:"vt--label",children:s})]})}})}},t={};function n(e){var r=t[e];if(void 0!==r)return r.exports;var o=t[e]={exports:{}};return i[e](o,o.exports,n),o.exports}n.m=i,e=[],n.O=(i,t,r,o)=>{if(!t){var l=1/0;for(u=0;u<e.length;u++){for(var[t,r,o]=e[u],s=!0,a=0;a<t.length;a++)(!1&o||l>=o)&&Object.keys(n.O).every(e=>n.O[e](t[a]))?t.splice(a--,1):(s=!1,o<l&&(l=o));if(s){e.splice(u--,1);var c=r();void 0!==c&&(i=c)}}return i}o=o||0;for(var u=e.length;u>0&&e[u-1][2]>o;u--)e[u]=e[u-1];e[u]=[t,r,o]},n.o=(e,i)=>Object.prototype.hasOwnProperty.call(e,i),(()=>{var e={2367:0,7399:0};n.O.j=i=>0===e[i];var i=(i,t)=>{var r,o,[l,s,a]=t,c=0;if(l.some(i=>0!==e[i])){for(r in s)n.o(s,r)&&(n.m[r]=s[r]);if(a)var u=a(n)}for(i&&i(t);c<l.length;c++)o=l[c],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return n.O(u)},t=globalThis.webpackChunkvt_music_training=globalThis.webpackChunkvt_music_training||[];t.forEach(i.bind(null,0)),t.push=i.bind(null,t.push.bind(t))})();var r=n.O(void 0,[7399],()=>n(893));r=n.O(r)})();