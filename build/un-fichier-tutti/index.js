(()=>{"use strict";var e,i={893:()=>{const e=window.wp.blocks,i=window.wp.blockEditor,t=(window.wp.i18n,window.wp.components),r=window.wp.primitives,n=window.ReactJSXRuntime,o=(0,n.jsx)(r.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)(r.Path,{d:"M17 10h-1.2V7c0-2.1-1.7-3.8-3.8-3.8-2.1 0-3.8 1.7-3.8 3.8h1.5c0-1.2 1-2.2 2.2-2.2s2.2 1 2.2 2.2v3H7c-.6 0-1 .4-1 1v8c0 .6.4 1 1 1h10c.6 0 1-.4 1-1v-8c0-.6-.4-1-1-1z"})}),l=(0,n.jsx)(r.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)(r.Path,{d:"M17 10h-1.2V7c0-2.1-1.7-3.8-3.8-3.8-2.1 0-3.8 1.7-3.8 3.8v3H7c-.6 0-1 .4-1 1v8c0 .6.4 1 1 1h10c.6 0 1-.4 1-1v-8c0-.6-.4-1-1-1zm-2.8 0H9.8V7c0-1.2 1-2.2 2.2-2.2s2.2 1 2.2 2.2v3z"})}),s=(0,n.jsx)(r.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)(r.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M5.5 12a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0ZM12 4a8 8 0 1 0 0 16 8 8 0 0 0 0-16Zm.75 4v1.5h-1.5V8h1.5Zm0 8v-5h-1.5v5h1.5Z"})}),c=window.wp.element,a=window.wp.data,h=JSON.parse('{"UU":"vt-music-training/un-fichier-tutti"}');(0,e.registerBlockType)(h.UU,{edit:function(e){console.log("Edit fichier tutti");const r=(0,i.useBlockProps)(),{context:h,attributes:u,setAttributes:d,clientId:p}=e,{"bloc-fichiers-de-travail/cheminFichiers":m}=h,{labelFichierTutti:v,cheminFichierTutti:f,nomFichierTutti:x,typeFichierTutti:w,affichageClavier:g,fichierStereo:j,lyricsPrompter:y}=u,b=function(e,t){return(0,a.useSelect)(r=>{const{getBlockParents:n,getBlockAttributes:o}=r(i.store),l=n(e);for(const e of l){const i=o(e);if(i?.[t])return i[t]}return""},[e,t])}(p,"lyricsPrompter");""==y&&""!=b&&d({lyricsPrompter:b});const[T,C]=(0,c.useState)(!1),[F,k]=(0,c.useState)(!1);f||d({cheminFichierTutti:m});const P=(0,c.useRef)(),[S,O]=(0,c.useState)(!1),[N,B]=(0,c.useState)(null),V=`${window.location.origin}${f}/${x}`;return(0,n.jsx)("div",{...r,children:e.isSelected?(0,n.jsxs)("div",{children:[(0,n.jsx)(t.TextControl,{label:"Label du fichier 'tutti' (audio ou vidéo)",help:"Par ex.: Video/partition Interprète",value:v,onChange:e=>d({labelFichierTutti:e})}),(0,n.jsx)("label",{className:"css-2o4jwd ej5x27r2 css-qy3gpb",children:"Prompteur pour le fichier tutti"}),(0,n.jsx)(i.RichText,{tagName:"div",className:"vt--lyrics-prompter components-text-control__input",value:y,onChange:e=>d({lyricsPrompter:e}),placeholder:"Saisissez le prompteur... ou un _ (underscore) pour 'pas de prompteur'",allowedFormats:["core/bold","core/italic","core/link","core/underline","core/text-color"]}),(0,n.jsx)(t.TextControl,{label:"Chemin du fichier 'tutti'",value:f,onChange:e=>d({cheminFichierTutti:e})}),(0,n.jsxs)(t.Flex,{align:"flex-end",style:{gap:"0.5em",marginBottom:"1em"},children:[(0,n.jsx)(t.FlexItem,{style:{flexGrow:1,position:"relative"},children:(0,n.jsx)(t.TextControl,{label:"Nom du fichier",value:x,readOnly:!T,onChange:e=>d({nomFichierTutti:e})})}),(0,n.jsx)(t.FlexItem,{children:(0,n.jsx)(t.Tooltip,{text:T?"Verrouiller le champ":"Déverrouiller pour modifier",children:(0,n.jsx)(t.IconButton,{icon:T?o:l,label:T?"Verrouiller":"Déverrouiller",onClick:()=>C(!T),isPressed:T})})}),(0,n.jsx)(t.FlexItem,{children:(0,n.jsx)(t.Tooltip,{text:"Aide sur le nom de fichier",children:(0,n.jsx)(t.IconButton,{icon:s,label:"Information sur le nom du fichier",onClick:()=>k(!0),isTertiary:!0})})})]}),F&&(0,n.jsxs)(t.Modal,{title:"Aide sur le nom du fichier",onRequestClose:()=>k(!1),children:[(0,n.jsx)("p",{children:"Le nom du fichier est défini automatiquement après le téléchargement du fichier choisi. Dans la plupart des cas, il n’est pas nécessaire de le modifier."}),(0,n.jsx)("p",{children:"Cependant, vous pouvez exceptionnellement cliquer sur le cadenas pour déverrouiller le champ et saisir un nom personnalisé. (Par exemple, pour indiquer un fichier déjà téléchargé)."}),(0,n.jsx)("div",{style:{textAlign:"right",marginTop:"1em"},children:(0,n.jsx)(t.Button,{variant:"primary",onClick:()=>k(!1),children:"Fermer"})})]}),(0,n.jsxs)("div",{style:{marginTop:"1em"},children:[(0,n.jsx)("label",{className:"label css-2o4jwd",style:{display:"none"},children:x?"Remplacer le fichier":"Choisir un fichier"}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1em"},children:[(0,n.jsx)("button",{type:"button",onClick:()=>P.current.click(),className:"components-button is-secondary",children:x?"Choisir un nouveau fichier":"Choisir un fichier"}),(0,n.jsx)("span",{style:{fontStyle:"italic",fontSize:"1rem"},children:x||"Aucun fichier sélectionné"}),(0,n.jsx)("input",{type:"file",accept:"audio/*,video/*",ref:P,onChange:async e=>{const i=e.target.files[0];if(i){O(!0),B(null);try{if(x){console.log("suppression "+x);const e=await async function(e,i){if(!vtmtData||!vtmtData.nonce)throw new Error("Nonce manquant ou non injecté.");const t=new FormData;t.append("file",e),t.append("chemin",i);const r=await fetch("/wp-json/vt-music-training/v1/supprimer-fichier",{method:"POST",body:t,credentials:"include",headers:{"X-WP-Nonce":vtmtData.nonce}});if(!r.ok){const e=await r.json();throw new Error(e.message||"Erreur lors de la suppression du fichier précédent")}return await r.json()}(x,f);console.log(e.comment)}console.log("file avant uploadFileToServer "+i);const e=await async function(e,i){if(!vtmtData||!vtmtData.nonce)throw new Error("Nonce manquant ou non injecté.");const t=new FormData;t.append("file",e),t.append("chemin",i);const r=await fetch("/wp-json/vt-music-training/v1/upload-fichier",{method:"POST",body:t,credentials:"include",headers:{"X-WP-Nonce":vtmtData.nonce}});if(!r.ok){const e=await r.json();throw new Error(e.message||"Erreur lors de l’upload")}return await r.json()}(i,f);console.log("resultUpload "+e),d({nomFichierTutti:e.nom,cheminFichierTutti:e.chemin}),console.log("Upload "+e.chemin+" - "+e.nom)}catch(e){console.error(e),B(e.message)}finally{O(!1)}}},style:{display:"none"}})]})]}),S&&(0,n.jsx)("p",{children:"📤 Téléversement en cours..."}),N&&(0,n.jsxs)("p",{style:{color:"red"},children:["❌ ",N]}),x&&(0,n.jsxs)("div",{style:{marginTop:"1em",width:"100%",maxWidth:"250px"},children:[(0,n.jsxs)("p",{style:{display:"none"},children:[(0,n.jsx)("strong",{children:"Fichier sélectionné :"})," ",x]}),x.match(/\.(mp3|wav)$/i)&&(0,n.jsx)("audio",{controls:!0,src:V,children:"Votre navigateur ne supporte pas l’audio."}),x.match(/\.(mp4|webm)$/i)&&(0,n.jsx)("video",{controls:!0,src:V,children:"Votre navigateur ne supporte pas la vidéo."}),!x.match(/\.(mp3|wav|mp4|webm)$/i)&&(0,n.jsx)("a",{href:V,target:"_blank",rel:"noopener noreferrer",children:"📄 Ouvrir le fichier"})]}),(0,n.jsx)(t.RadioControl,{label:"Type de fichier",selected:w,options:[{label:"audio",value:"a"},{label:"video",value:"v"}],onChange:e=>d({typeFichierTutti:e})}),(0,n.jsx)(t.ToggleControl,{label:"Afficher le clavier sous le lecteur",checked:g,onChange:e=>d({affichageClavier:e})}),g&&(0,n.jsx)(t.ToggleControl,{label:"Le fichier est stéréo : la voix principale a une piste dédiée",checked:j,onChange:e=>d({fichierStereo:e})})]}):(0,n.jsx)("div",{children:v})})},save:function(e){const t=i.useBlockProps.save(),{attributes:{cheminFichierTutti:r,nomFichierTutti:o,typeFichierTutti:l,labelFichierTutti:s,affichageClavier:c,fichierStereo:a,lyricsPrompter:h}}=e;return(0,n.jsxs)("div",{...t,className:"vt--un-fichier-tutti","data-chemin":r,"data-nomfichier":o,"data-type":l,"data-clavier":c,"data-stereo":a,"data-prompter":h,children:[(0,n.jsx)("i",{className:"fa-solid fa-square-caret-right"}),(0,n.jsx)("div",{className:"vt--label",children:s})]})}})}},t={};function r(e){var n=t[e];if(void 0!==n)return n.exports;var o=t[e]={exports:{}};return i[e](o,o.exports,r),o.exports}r.m=i,e=[],r.O=(i,t,n,o)=>{if(!t){var l=1/0;for(h=0;h<e.length;h++){for(var[t,n,o]=e[h],s=!0,c=0;c<t.length;c++)(!1&o||l>=o)&&Object.keys(r.O).every(e=>r.O[e](t[c]))?t.splice(c--,1):(s=!1,o<l&&(l=o));if(s){e.splice(h--,1);var a=n();void 0!==a&&(i=a)}}return i}o=o||0;for(var h=e.length;h>0&&e[h-1][2]>o;h--)e[h]=e[h-1];e[h]=[t,n,o]},r.o=(e,i)=>Object.prototype.hasOwnProperty.call(e,i),(()=>{var e={2367:0,7399:0};r.O.j=i=>0===e[i];var i=(i,t)=>{var n,o,[l,s,c]=t,a=0;if(l.some(i=>0!==e[i])){for(n in s)r.o(s,n)&&(r.m[n]=s[n]);if(c)var h=c(r)}for(i&&i(t);a<l.length;a++)o=l[a],r.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return r.O(h)},t=globalThis.webpackChunkvt_music_training=globalThis.webpackChunkvt_music_training||[];t.forEach(i.bind(null,0)),t.push=i.bind(null,t.push.bind(t))})();var n=r.O(void 0,[7399],()=>r(893));n=r.O(n)})();