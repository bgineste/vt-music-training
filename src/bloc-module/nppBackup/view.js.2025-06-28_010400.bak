/** 
  Fonctions liées au bloc-module
  V 1.0 
*/

document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll(".vt--bouton-bloc-esc").forEach(obj => {
        obj.addEventListener("click", () => {
            console.log("Fonction x exécutée !");
            bascule_affichage_module(obj);
        });
    });
});


/*
function bascule_affichage_module(bouton_esc) {
	console.log(bouton_esc);
	
	// recherche du bloc d'entrainement qui renferme le bouton escape actionné
	var bloc_entrainement = bouton_esc.closest('.vt--un-module');
	var id_bloc_entrainement = bloc_entrainement.id; // sera utile pour le cookie stockant le statut du bloc_esc
	// recherche du bloc qui encadre le module. Il est utile de le connaître pour faire varier son padding en fontion du statut (affiché/masqué) du module 
	var bloc_encadrant_module = bloc_entrainement; //bouton_esc.closest('.ec__un-morceau');
	// recherche du bloc escamotable
	var bloc_esc = bloc_entrainement.getElementsByClassName('vt--bloc-esc')[0];

    if(bouton_esc.checked)
    {
        bloc_esc.style.display="block";
		//restituer les padding du bloc entrainement
		bloc_encadrant_module.style.paddingTop = bloc_encadrant_module_padding_top;
		bloc_encadrant_module.style.paddingBottom = bloc_encadrant_module_padding_bottom;
		createCookie('vt-'+id_bloc_entrainement,"Affiché",365);
    }
    else
    {
        bloc_esc.style.display="none";
        //réduire les paddings du bloc entrainement pour qu'il occupe moins de place
		bloc_encadrant_module.style.paddingTop = "5px";
		bloc_encadrant_module.style.paddingBottom = "5px";
		createCookie('vt-'+id_bloc_entrainement,"Masqué",365);
    }
	
    return true;
}
*/	

function bascule_affichage_module(boutonEsc) {
	console.log(boutonEsc);

	const blocEntrainement = boutonEsc.closest('.vt--un-module');
	if (!blocEntrainement) return;

	const idBlocEntrainement = blocEntrainement.id;
	const blocEsc = blocEntrainement.querySelector('.vt--bloc-esc');
	if (!blocEsc) return;

	const blocEncadrant = blocEntrainement; // modifiable si un parent différent est requis

	// Valeurs par défaut si variables globales non définies
	const defaultPaddingTop = "20px";  // ajuster selon besoin
	const defaultPaddingBottom = "20px";

	const expandedPaddingTop = typeof bloc_encadrant_module_padding_top !== 'undefined'
		? bloc_encadrant_module_padding_top
		: defaultPaddingTop;

	const expandedPaddingBottom = typeof bloc_encadrant_module_padding_bottom !== 'undefined'
		? bloc_encadrant_module_padding_bottom
		: defaultPaddingBottom;

	if (boutonEsc.checked) {
		blocEsc.style.display = "block";
		blocEncadrant.style.paddingTop = expandedPaddingTop;
		blocEncadrant.style.paddingBottom = expandedPaddingBottom;
		createCookie(`vt-${idBlocEntrainement}`, "Affiché", 365);
	} else {
		blocEsc.style.display = "none";
		blocEncadrant.style.paddingTop = "5px";
		blocEncadrant.style.paddingBottom = "5px";
		createCookie(`vt-${idBlocEntrainement}`, "Masqué", 365);
	}

	return true;
}