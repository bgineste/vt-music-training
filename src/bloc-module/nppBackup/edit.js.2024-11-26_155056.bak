import { useBlockProps, InnerBlocks } from '@wordpress/block-editor';
import { TextControl } from '@wordpress/components';
import './editor.scss';

export default function Edit(props) {
    const blockProps = useBlockProps();

    // Déconstruction des props
    const { context } = props;
    const { "bloc-oeuvre/cheminFichiersOeuvre": cheminFichiersOeuvre } = context;
    const { attributes: { cheminFichiersModule, titreModule }, setAttributes } = props;

    // Initialisation du chemin si absent
    if (!cheminFichiersModule) {
        setAttributes({ cheminFichiersModule: cheminFichiersOeuvre });
    }

    // Template pour la zone structurée
    const TEMPLATE_PRONONCIATIONS = [
        ['vt-music-training/bloc-prononciation', { placeholder: 'Prononciations' }]
    ];

    return (
        <div {...blockProps}>
            {/* Mode d'édition */}
            {props.isSelected ? (
                <div className="vt--parametrage-bloc">
                    <TextControl
                        label="Titre du morceau"
                        value={titreModule}
                        onChange={(val) => setAttributes({ titreModule: val })}
                    />
                    <TextControl
                        label="Chemin des fichiers du morceau"
                        value={cheminFichiersModule}
                        onChange={(val) => setAttributes({ cheminFichiersModule: val })}
                    />
                    <p>Insérer ici les blocs qui composent le module : paroles, vidéos, audios, etc.</p>
                    
                    {/* Zone libre */}
                    <div className="vt--zone-libre">
                        <InnerBlocks
                            allowedBlocks={null} // Tous les blocs autorisés
                            template={[]} // Pas de template ici
                            templateLock={false} // Zone libre
                            placeholder="Ajoutez vos blocs libres ici"
                        />
						console.log('Zone libre - InnerBlocks props:', {
    allowedBlocks: null,
    template: [],
    templateLock: false
});

                    </div>

                    <p>Insérer ici les blocs audios de prononciation</p>
                    
                    {/* Zone structurée */}
                    <div className="vt--prononciations">
                        <InnerBlocks
                            template={TEMPLATE_PRONONCIATIONS} // Template défini
                            templateLock="all" // Verrouillé
                        />
						console.log('Zone structurée - InnerBlocks props:', {
    template: TEMPLATE_PRONONCIATIONS,
    templateLock: 'all'
});
                    </div>
                </div>
            ) : (
                /* Mode d'affichage */
                <div className="wp-block-group vt--un-module">
                    <h4 className="has-blue-color has-text-color wp-block-heading">{titreModule}</h4>
                    
                    {/* Zone libre */}
                    <div className="vt--zone-libre">
                        <h5>Zone libre</h5>
                        <InnerBlocks
                            allowedBlocks={null} // Tous les blocs autorisés
                            template={[]} // Pas de template ici
                            templateLock={false} // Zone libre
                            placeholder="Ajoutez ici vos blocs libres"
                        />
                    </div>
                    
                    {/* Zone structurée */}
                    <div className="vt--prononciations">
                        <h5>Zone structurée</h5>
                        <InnerBlocks
                            template={TEMPLATE_PRONONCIATIONS} // Template défini
                            templateLock="all" // Verrouillé
                        />
                    </div>
                </div>
            )}
        </div>
    );
}
