/** Fonction pour index-oeuvre
	Récupère les id des modules de chaque oeuvre pour pouvoir les indexer
*/

document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll(".vt--block-bouton-index").forEach(bouton => {
        bouton.addEventListener("click", () => {
			bouton.nextElementSibling.style.display = 'flex';
			bouton.nextElementSibling.getElementsByClassName('vt--wrap-index-choeurs')[0].innerHTML = innerHTMLindexOeuvre(bouton.parentNode);
		});
    });
});


function innerHTMLindexOeuvre(element) {
	var HTMLindex = ''
	let sibling = element.nextElementSibling;

	while (sibling) {
		let el_titres = sibling.getElementsByClassName('vt--titre-de-morceau');
		if (el_titres && sibling.id && !sibling.className.includes('vt--display-none')) {
			HTMLindex = HTMLindex +'<div class="vt--lien-vers-ancre" onclick="var o=this.closest(\'.vt--une-oeuvre\'); var oCible=document.getElementById(\'' + sibling.id + '\'); var boutonEsc = oCible.getElementsByClassName(\'vt--bouton-bloc-esc\')[0]; boutonEsc.checked=false; boutonEsc.click(); vtmusicScrollToAncor(\'' + sibling.id + '\', ' + vtHauteurReservee + '); this.closest(\'.vt--popup__support\').style.display=\'none\';"> ' + vtmusicTruncate(el_titres[0].innerText,25) + ' </div>'
		}
		sibling = sibling.nextElementSibling
	}
	HTMLindex = HTMLindex + '<div class="vt--lien-vers-ancre" style="background-color: var(--vt--bg-flash);" onClick="this.closest(\'.vt--popup__support\').style.display=\'none\';">Retour</div>'
	return HTMLindex
}
