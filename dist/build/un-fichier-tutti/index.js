(()=>{"use strict";var e,i={660:()=>{const e=window.wp.blocks,i=window.wp.blockEditor,t=(window.wp.i18n,window.wp.components),n=window.wp.element,r=window.ReactJSXRuntime,o=JSON.parse('{"UU":"vt-music-training/un-fichier-tutti"}');(0,e.registerBlockType)(o.UU,{edit:function(e){const o=(0,i.useBlockProps)(),{context:a,attributes:c,setAttributes:s,clientId:l}=e,{"bloc-fichiers-de-travail/cheminFichiers":h}=a,{labelFichierTutti:u,cheminFichierTutti:d,nomFichierTutti:p,typeFichierTutti:m,affichageClavier:v,fichierStereo:f}=c;d||s({cheminFichierTutti:h});const w=(0,n.useRef)(),[g,x]=(0,n.useState)(!1),[b,j]=(0,n.useState)(null),y=`${window.location.origin}${d}/${p}`;return(0,r.jsx)("div",{...o,children:e.isSelected?(0,r.jsxs)("div",{children:[(0,r.jsx)(t.TextControl,{label:"Label du fichier 'tutti' (audio ou vidéo)",help:"Par ex.: Video/partition Interprète",value:u,onChange:e=>s({labelFichierTutti:e})}),(0,r.jsx)(t.TextControl,{label:"Chemin du fichier 'tutti'",value:d,onChange:e=>s({cheminFichierTutti:e})}),(0,r.jsx)(t.TextControl,{label:"Nom du fichier",value:p,readOnly:!0}),(0,r.jsxs)("div",{style:{marginTop:"1em"},children:[(0,r.jsx)("label",{className:"label css-2o4jwd",style:{display:"none"},children:p?"Remplacer le fichier":"Choisir un fichier"}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1em"},children:[(0,r.jsx)("button",{type:"button",onClick:()=>w.current.click(),className:"components-button is-secondary",children:p?"Choisir un nouveau fichier":"Choisir un fichier"}),(0,r.jsx)("span",{style:{fontStyle:"italic",fontSize:"1rem"},children:p||"Aucun fichier sélectionné"}),(0,r.jsx)("input",{type:"file",accept:"audio/*,video/*",ref:w,onChange:async e=>{const i=e.target.files[0];if(i){x(!0),j(null);try{if(p){console.log("suppression "+p);const e=await async function(e,i){if(!vtmtData||!vtmtData.nonce)throw new Error("Nonce manquant ou non injecté.");const t=new FormData;t.append("file",e),t.append("chemin",i);const n=await fetch("/wp-json/vt-music-training/v1/supprimer-fichier",{method:"POST",body:t,credentials:"include",headers:{"X-WP-Nonce":vtmtData.nonce}});if(!n.ok){const e=await n.json();throw new Error(e.message||"Erreur lors de la suppression du fichier précédent")}return await n.json()}(p,d);console.log(e.comment)}console.log("file avant uploadFileToServer "+i);const e=await async function(e,i){if(!vtmtData||!vtmtData.nonce)throw new Error("Nonce manquant ou non injecté.");const t=new FormData;t.append("file",e),t.append("chemin",i);const n=await fetch("/wp-json/vt-music-training/v1/upload-fichier",{method:"POST",body:t,credentials:"include",headers:{"X-WP-Nonce":vtmtData.nonce}});if(!n.ok){const e=await n.json();throw new Error(e.message||"Erreur lors de l’upload")}return await n.json()}(i,d);console.log("resultUpload "+e),s({nomFichierTutti:e.nom,cheminFichierTutti:e.chemin}),console.log("Upload "+e.chemin+" - "+e.nom)}catch(e){console.error(e),j(e.message)}finally{x(!1)}}},style:{display:"none"}})]})]}),g&&(0,r.jsx)("p",{children:"📤 Téléversement en cours..."}),b&&(0,r.jsxs)("p",{style:{color:"red"},children:["❌ ",b]}),p&&(0,r.jsxs)("div",{style:{marginTop:"1em",width:"100%",maxWidth:"250px"},children:[(0,r.jsxs)("p",{style:{display:"none"},children:[(0,r.jsx)("strong",{children:"Fichier sélectionné :"})," ",p]}),p.match(/\.(mp3|wav)$/i)&&(0,r.jsx)("audio",{controls:!0,src:y,children:"Votre navigateur ne supporte pas l’audio."}),p.match(/\.(mp4|webm)$/i)&&(0,r.jsx)("video",{controls:!0,src:y,children:"Votre navigateur ne supporte pas la vidéo."}),!p.match(/\.(mp3|wav|mp4|webm)$/i)&&(0,r.jsx)("a",{href:y,target:"_blank",rel:"noopener noreferrer",children:"📄 Ouvrir le fichier"})]}),(0,r.jsx)(t.RadioControl,{label:"Type de fichier",selected:m,options:[{label:"audio",value:"a"},{label:"video",value:"v"}],onChange:e=>s({typeFichierTutti:e})}),(0,r.jsx)(t.ToggleControl,{label:"Afficher le clavier sous le lecteur",checked:v,onChange:e=>s({affichageClavier:e})}),v&&(0,r.jsx)(t.ToggleControl,{label:"Le fichier est stéréo : la voix principale a une piste dédiée",checked:f,onChange:e=>s({fichierStereo:e})})]}):(0,r.jsx)("div",{children:u})})},save:function(e){const t=i.useBlockProps.save(),{attributes:{cheminFichierTutti:n,nomFichierTutti:o,typeFichierTutti:a,labelFichierTutti:c,affichageClavier:s,fichierStereo:l}}=e;return(0,r.jsxs)("div",{...t,className:"vt--un-fichier-tutti","data-chemin":n,"data-nom":o,"data-type":a,"data-clavier":s,"data-stereo":l,children:[(0,r.jsx)("i",{class:"fa-solid fa-square-caret-right"}),(0,r.jsx)("div",{className:"vt--label",children:c})]})}})}},t={};function n(e){var r=t[e];if(void 0!==r)return r.exports;var o=t[e]={exports:{}};return i[e](o,o.exports,n),o.exports}n.m=i,e=[],n.O=(i,t,r,o)=>{if(!t){var a=1/0;for(h=0;h<e.length;h++){for(var[t,r,o]=e[h],c=!0,s=0;s<t.length;s++)(!1&o||a>=o)&&Object.keys(n.O).every(e=>n.O[e](t[s]))?t.splice(s--,1):(c=!1,o<a&&(a=o));if(c){e.splice(h--,1);var l=r();void 0!==l&&(i=l)}}return i}o=o||0;for(var h=e.length;h>0&&e[h-1][2]>o;h--)e[h]=e[h-1];e[h]=[t,r,o]},n.o=(e,i)=>Object.prototype.hasOwnProperty.call(e,i),(()=>{var e={367:0,399:0};n.O.j=i=>0===e[i];var i=(i,t)=>{var r,o,[a,c,s]=t,l=0;if(a.some(i=>0!==e[i])){for(r in c)n.o(c,r)&&(n.m[r]=c[r]);if(s)var h=s(n)}for(i&&i(t);l<a.length;l++)o=a[l],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return n.O(h)},t=globalThis.webpackChunkvt_music_training=globalThis.webpackChunkvt_music_training||[];t.forEach(i.bind(null,0)),t.push=i.bind(null,t.push.bind(t))})();var r=n.O(void 0,[399],()=>n(660));r=n.O(r)})();