(()=>{"use strict";var e,i={144:()=>{const e=window.wp.blocks,i=window.wp.blockEditor,t=(window.wp.i18n,window.wp.components),n=window.wp.element,r=window.ReactJSXRuntime,o=JSON.parse('{"UU":"vt-music-training/un-pupitre"}');(0,e.registerBlockType)(o.UU,{edit:function(e){const o=(0,i.useBlockProps)(),{context:a,attributes:c,setAttributes:s,clientId:l}=e,{"un-groupe-de-pupitres/cheminFichiers":u,"un-groupe-de-pupitres/typeFichiers":p,"un-groupe-de-pupitres/affichageClavier":h,"un-groupe-de-pupitres/fichierStereo":d}=a,{labelPupitre:v,nomFichier:m,cheminFichier:f,typeFichier:g,affichageClavier:w,fichierStereo:b}=c;f||s({cheminFichier:u}),g||s({typeFichier:p}),w||s({affichageClavier:h}),b||s({fichierStereo:d});const x=(0,n.useRef)(),[j,y]=(0,n.useState)(!1),[C,F]=(0,n.useState)(null),k=c.chaineFichiersPupitre?JSON.parse(c.chaineFichiersPupitre):[],[S,O]=(0,n.useState)(k);return(0,r.jsx)("div",{...o,children:e.isSelected?(0,r.jsxs)("div",{className:"vt--editor-un-pupitre",children:[(0,r.jsx)(t.TextControl,{label:"Label du pupitre",help:"Par ex. : S pour Soprano, A pour Alto...",value:v,onChange:e=>s({labelPupitre:e})}),(0,r.jsx)(t.TextControl,{label:"Chemin du fichier",value:f,onChange:e=>s({cheminFichier:e})}),(0,r.jsx)(t.TextControl,{label:"Nom du fichier",value:m,readOnly:!0}),(0,r.jsxs)("div",{style:{marginTop:"1em"},children:[(0,r.jsx)("button",{type:"button",onClick:()=>x.current.click(),className:"components-button is-secondary",children:m?"Choisir un nouveau fichier":"Choisir un fichier"}),(0,r.jsx)("input",{type:"file",accept:"audio/*,video/*",ref:x,onChange:e=>(async e=>{const i=e.target.files[0];if(console.log(e.target),!i)return;y(!0),F(null);let t=m;try{if(t){console.log("suppression "+t);const e=await async function(e,i){if(!vtmtData||!vtmtData.nonce)throw new Error("Nonce manquant ou non injecté.");const t=new FormData;t.append("file",e),t.append("chemin",i);const n=await fetch("/wp-json/vt-music-training/v1/supprimer-fichier",{method:"POST",body:t,credentials:"include",headers:{"X-WP-Nonce":vtmtData.nonce}});if(!n.ok){const e=await n.json();throw new Error(e.message||"Erreur lors de la suppression du fichier précédent")}return await n.json()}(t,f);console.log(e.comment)}const e=await async function(e,i){if(!vtmtData||!vtmtData.nonce)throw new Error("Nonce manquant ou non injecté.");const t=new FormData;t.append("file",e),t.append("chemin",i);const n=await fetch("/wp-json/vt-music-training/v1/upload-fichier",{method:"POST",body:t,credentials:"include",headers:{"X-WP-Nonce":vtmtData.nonce}});if(!n.ok){const e=await n.json();throw new Error(e.message||"Erreur lors de l’upload")}return await n.json()}(i,f);console.log(e),s({nomFichier:e.nom}),console.log("Upload "+e.chemin+" - "+e.nom)}catch(e){console.error(e),y(!1)}finally{F(null),y(!1)}})(e),style:{display:"none"}})]}),j&&(0,r.jsx)("p",{children:"📤 Téléversement en cours..."}),C&&(0,r.jsxs)("p",{style:{color:"red"},children:["❌ ",C]}),m&&(0,r.jsxs)("div",{style:{marginTop:"1em",maxWidth:"250px"},children:[m.match(/\.(mp3|wav)$/i)&&(0,r.jsx)("audio",{controls:!0,src:`${window.location.origin}${f}/${m}`,children:"Votre navigateur ne supporte pas l’audio."}),m.match(/\.(mp4|webm)$/i)&&(0,r.jsx)("video",{controls:!0,src:`${window.location.origin}${f}/${m}`,children:"Votre navigateur ne supporte pas la vidéo."})]}),(0,r.jsx)(t.RadioControl,{label:"Type de fichier",selected:g,options:[{label:"audio",value:"a"},{label:"video",value:"v"}],onChange:e=>s({typeFichier:e})}),(0,r.jsx)(t.ToggleControl,{label:"Afficher le clavier sous le lecteur",checked:w,onChange:e=>s({affichageClavier:e})}),w&&(0,r.jsx)(t.ToggleControl,{label:"Le fichier est stéréo : la voix principale a une piste dédiée",checked:b,onChange:e=>s({fichierStereo:e})})]}):(0,r.jsx)("div",{className:"vt--pupitre-button","data-chemin":f,"data-nomfichier":m,"data-type":g,"data-clavier":w,"data-stereo":b,children:(0,r.jsxs)("div",{className:"vt--pupitre-label",children:[" ",v," "]})})})},save:function({attributes:e}){const t=i.useBlockProps.save(),{labelPupitre:n,cheminFichier:o,nomFichier:a,typeFichier:c,affichageClavier:s,fichierStereo:l}=e;return(0,r.jsx)("div",{...t,className:"vt--pupitre-button","data-chemin":o,"data-nomfichier":a,"data-type":c,"data-clavier":s,"data-stereo":l,children:(0,r.jsxs)("div",{className:"vt--pupitre-label",children:[" ",n," "]})})}})}},t={};function n(e){var r=t[e];if(void 0!==r)return r.exports;var o=t[e]={exports:{}};return i[e](o,o.exports,n),o.exports}n.m=i,e=[],n.O=(i,t,r,o)=>{if(!t){var a=1/0;for(u=0;u<e.length;u++){for(var[t,r,o]=e[u],c=!0,s=0;s<t.length;s++)(!1&o||a>=o)&&Object.keys(n.O).every(e=>n.O[e](t[s]))?t.splice(s--,1):(c=!1,o<a&&(a=o));if(c){e.splice(u--,1);var l=r();void 0!==l&&(i=l)}}return i}o=o||0;for(var u=e.length;u>0&&e[u-1][2]>o;u--)e[u]=e[u-1];e[u]=[t,r,o]},n.o=(e,i)=>Object.prototype.hasOwnProperty.call(e,i),(()=>{var e={691:0,803:0};n.O.j=i=>0===e[i];var i=(i,t)=>{var r,o,[a,c,s]=t,l=0;if(a.some(i=>0!==e[i])){for(r in c)n.o(c,r)&&(n.m[r]=c[r]);if(s)var u=s(n)}for(i&&i(t);l<a.length;l++)o=a[l],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return n.O(u)},t=globalThis.webpackChunkvt_music_training=globalThis.webpackChunkvt_music_training||[];t.forEach(i.bind(null,0)),t.push=i.bind(null,t.push.bind(t))})();var r=n.O(void 0,[803],()=>n(144));r=n.O(r)})();