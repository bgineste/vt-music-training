(()=>{"use strict";var e,i={633:()=>{const e=window.wp.blocks,i=window.wp.blockEditor,r=(window.wp.i18n,window.wp.components),t=window.wp.primitives,o=window.ReactJSXRuntime,n=(0,o.jsx)(t.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,o.jsx)(t.Path,{d:"M17 10h-1.2V7c0-2.1-1.7-3.8-3.8-3.8-2.1 0-3.8 1.7-3.8 3.8h1.5c0-1.2 1-2.2 2.2-2.2s2.2 1 2.2 2.2v3H7c-.6 0-1 .4-1 1v8c0 .6.4 1 1 1h10c.6 0 1-.4 1-1v-8c0-.6-.4-1-1-1z"})}),a=(0,o.jsx)(t.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,o.jsx)(t.Path,{d:"M17 10h-1.2V7c0-2.1-1.7-3.8-3.8-3.8-2.1 0-3.8 1.7-3.8 3.8v3H7c-.6 0-1 .4-1 1v8c0 .6.4 1 1 1h10c.6 0 1-.4 1-1v-8c0-.6-.4-1-1-1zm-2.8 0H9.8V7c0-1.2 1-2.2 2.2-2.2s2.2 1 2.2 2.2v3z"})}),l=(0,o.jsx)(t.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,o.jsx)(t.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M5.5 12a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0ZM12 4a8 8 0 1 0 0 16 8 8 0 0 0 0-16Zm.75 4v1.5h-1.5V8h1.5Zm0 8v-5h-1.5v5h1.5Z"})}),s=window.wp.element,c=window.wp.data,p=JSON.parse('{"UU":"vt-music-training/un-pupitre"}');(0,e.registerBlockType)(p.UU,{edit:function(e){const t=(0,i.useBlockProps)(),{context:p,attributes:u,setAttributes:d,clientId:h}=e,{"un-groupe-de-pupitres/cheminFichiers":m,"un-groupe-de-pupitres/typeFichiers":v,"un-groupe-de-pupitres/affichageClavier":f,"un-groupe-de-pupitres/fichierStereo":x}=p,{labelPupitre:w,nomFichier:g,cheminFichier:j,typeFichier:b,affichageClavier:y,fichierStereo:C,lyricsPrompter:P}=u,[k,F]=(0,s.useState)(!1),[S,T]=(0,s.useState)(!1);j||d({cheminFichier:m}),b||d({typeFichier:v}),y||d({affichageClavier:f}),C||d({fichierStereo:x});const N=function(e,r){return(0,c.useSelect)(t=>{const{getBlockParents:o,getBlockAttributes:n}=t(i.store),a=o(e);for(const e of a){const i=n(e);if(i?.[r])return i[r]}return""},[e,r])}(h,"lyricsPrompter");""==P&&""!=N&&d({lyricsPrompter:N});const O=(0,s.useRef)(),[B,D]=(0,s.useState)(!1),[V,A]=(0,s.useState)(null);return(0,o.jsx)("div",{...t,children:e.isSelected?(0,o.jsxs)("div",{className:"vt--editor-un-pupitre",children:[(0,o.jsx)(r.TextControl,{label:"Label du pupitre",help:"Par ex. : S pour Soprano, A pour Alto...",value:w,onChange:e=>d({labelPupitre:e})}),(0,o.jsx)("label",{className:"css-2o4jwd ej5x27r2 css-qy3gpb",children:"Prompteur pour le pupitre"}),(0,o.jsx)(i.RichText,{tagName:"div",className:"vt--lyrics-prompter components-text-control__input",value:P,onChange:e=>d({lyricsPrompter:e}),placeholder:"Saisissez le prompteur... ou un _ (underscore) pour 'pas de prompteur'",allowedFormats:["core/bold","core/italic","core/link","core/underline","core/text-color"]}),(0,o.jsx)(r.TextControl,{label:"Chemin du fichier",value:j,onChange:e=>d({cheminFichier:e})}),(0,o.jsxs)(r.Flex,{align:"flex-end",style:{gap:"0.5em",marginBottom:"1em"},children:[(0,o.jsx)(r.FlexItem,{style:{flexGrow:1,position:"relative"},children:(0,o.jsx)(r.TextControl,{label:"Nom du fichier",value:g,readOnly:!k,onChange:e=>d({nomFichier:e})})}),(0,o.jsx)(r.FlexItem,{children:(0,o.jsx)(r.Tooltip,{text:k?"Verrouiller le champ":"Déverrouiller pour modifier",children:(0,o.jsx)(r.IconButton,{icon:k?n:a,label:k?"Verrouiller":"Déverrouiller",onClick:()=>F(!k),isPressed:k})})}),(0,o.jsx)(r.FlexItem,{children:(0,o.jsx)(r.Tooltip,{text:"Aide sur le nom de fichier",children:(0,o.jsx)(r.IconButton,{icon:l,label:"Information sur le nom du fichier",onClick:()=>T(!0),isTertiary:!0})})})]}),S&&(0,o.jsxs)(r.Modal,{title:"Aide sur le nom du fichier",onRequestClose:()=>T(!1),children:[(0,o.jsx)("p",{children:"Le nom du fichier est défini automatiquement après le téléchargement du fichier choisi. Dans la plupart des cas, il n’est pas nécessaire de le modifier."}),(0,o.jsx)("p",{children:"Cependant, vous pouvez exceptionnellement cliquer sur le cadenas pour déverrouiller le champ et saisir un nom personnalisé. (Par exemple, pour indiquer un fichier déjà téléchargé)."}),(0,o.jsx)("div",{style:{textAlign:"right",marginTop:"1em"},children:(0,o.jsx)(r.Button,{variant:"primary",onClick:()=>T(!1),children:"Fermer"})})]}),(0,o.jsxs)("div",{style:{marginTop:"1em"},children:[(0,o.jsx)("button",{type:"button",onClick:()=>O.current.click(),className:"components-button is-secondary",children:g?"Choisir un nouveau fichier":"Choisir un fichier"}),(0,o.jsx)("input",{type:"file",accept:"audio/*,video/*",ref:O,onChange:e=>(async e=>{const i=e.target.files[0];if(!i)return;D(!0),A(null);let r=g;try{if(r){console.log("suppression "+r);const e=await async function(e,i){if(!vtmtData||!vtmtData.nonce)throw new Error("Nonce manquant ou non injecté.");const r=new FormData;r.append("file",e),r.append("chemin",i);const t=await fetch("/wp-json/vt-music-training/v1/supprimer-fichier",{method:"POST",body:r,credentials:"include",headers:{"X-WP-Nonce":vtmtData.nonce}});if(!t.ok){const e=await t.json();throw new Error(e.message||"Erreur lors de la suppression du fichier précédent")}return await t.json()}(r,j);console.log(e.comment)}const e=await async function(e,i){if(!vtmtData||!vtmtData.nonce)throw new Error("Nonce manquant ou non injecté.");const r=new FormData;r.append("file",e),r.append("chemin",i);const t=await fetch("/wp-json/vt-music-training/v1/upload-fichier",{method:"POST",body:r,credentials:"include",headers:{"X-WP-Nonce":vtmtData.nonce}});if(!t.ok){const e=await t.json();throw new Error(e.message||"Erreur lors de l’upload")}return await t.json()}(i,j);console.log(e),d({nomFichier:e.nom}),console.log("Upload "+e.chemin+" - "+e.nom)}catch(e){console.error(e),D(!1)}finally{A(null),D(!1)}})(e),style:{display:"none"}})]}),B&&(0,o.jsx)("p",{children:"📤 Téléversement en cours..."}),V&&(0,o.jsxs)("p",{style:{color:"red"},children:["❌ ",V]}),g&&(0,o.jsxs)("div",{style:{marginTop:"1em",maxWidth:"250px"},children:[g.match(/\.(mp3|wav)$/i)&&(0,o.jsx)("audio",{controls:!0,src:`${window.location.origin}${j}/${g}`,children:"Votre navigateur ne supporte pas l’audio."}),g.match(/\.(mp4|webm)$/i)&&(0,o.jsx)("video",{controls:!0,src:`${window.location.origin}${j}/${g}`,children:"Votre navigateur ne supporte pas la vidéo."})]}),(0,o.jsx)(r.RadioControl,{label:"Type de fichier",selected:b,options:[{label:"audio",value:"a"},{label:"video",value:"v"}],onChange:e=>d({typeFichier:e})}),(0,o.jsx)(r.ToggleControl,{label:"Afficher le clavier sous le lecteur",checked:y,onChange:e=>d({affichageClavier:e})}),y&&(0,o.jsx)(r.ToggleControl,{label:"Le fichier est stéréo : la voix principale a une piste dédiée",checked:C,onChange:e=>d({fichierStereo:e})})]}):(0,o.jsx)("div",{className:"vt--pupitre-button","data-chemin":j,"data-nomfichier":g,"data-type":b,"data-clavier":y,"data-stereo":C,"data-prompter":P,children:(0,o.jsxs)("div",{className:"vt--pupitre-label",children:[" ",w," "]})})})},save:function({attributes:e}){const r=i.useBlockProps.save(),{labelPupitre:t,cheminFichier:n,nomFichier:a,typeFichier:l,affichageClavier:s,fichierStereo:c,lyricsPrompter:p}=e;return(0,o.jsx)("div",{...r,className:"vt--pupitre-button","data-chemin":n,"data-nomfichier":a,"data-type":l,"data-clavier":s,"data-stereo":c,"data-prompter":p,children:(0,o.jsxs)("div",{className:"vt--pupitre-label",children:[" ",t," "]})})}})}},r={};function t(e){var o=r[e];if(void 0!==o)return o.exports;var n=r[e]={exports:{}};return i[e](n,n.exports,t),n.exports}t.m=i,e=[],t.O=(i,r,o,n)=>{if(!r){var a=1/0;for(p=0;p<e.length;p++){for(var[r,o,n]=e[p],l=!0,s=0;s<r.length;s++)(!1&n||a>=n)&&Object.keys(t.O).every(e=>t.O[e](r[s]))?r.splice(s--,1):(l=!1,n<a&&(a=n));if(l){e.splice(p--,1);var c=o();void 0!==c&&(i=c)}}return i}n=n||0;for(var p=e.length;p>0&&e[p-1][2]>n;p--)e[p]=e[p-1];e[p]=[r,o,n]},t.o=(e,i)=>Object.prototype.hasOwnProperty.call(e,i),(()=>{var e={7691:0,2803:0};t.O.j=i=>0===e[i];var i=(i,r)=>{var o,n,[a,l,s]=r,c=0;if(a.some(i=>0!==e[i])){for(o in l)t.o(l,o)&&(t.m[o]=l[o]);if(s)var p=s(t)}for(i&&i(r);c<a.length;c++)n=a[c],t.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return t.O(p)},r=globalThis.webpackChunkvt_music_training=globalThis.webpackChunkvt_music_training||[];r.forEach(i.bind(null,0)),r.push=i.bind(null,r.push.bind(r))})();var o=t.O(void 0,[2803],()=>t(633));o=t.O(o)})();