(()=>{"use strict";var e,i={598:()=>{const e=window.wp.blocks,i=window.wp.blockEditor,r=(window.wp.i18n,window.wp.components),n=window.wp.primitives,t=window.ReactJSXRuntime,o=(0,t.jsx)(n.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,t.jsx)(n.Path,{d:"M17 10h-1.2V7c0-2.1-1.7-3.8-3.8-3.8-2.1 0-3.8 1.7-3.8 3.8h1.5c0-1.2 1-2.2 2.2-2.2s2.2 1 2.2 2.2v3H7c-.6 0-1 .4-1 1v8c0 .6.4 1 1 1h10c.6 0 1-.4 1-1v-8c0-.6-.4-1-1-1z"})}),a=(0,t.jsx)(n.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,t.jsx)(n.Path,{d:"M17 10h-1.2V7c0-2.1-1.7-3.8-3.8-3.8-2.1 0-3.8 1.7-3.8 3.8v3H7c-.6 0-1 .4-1 1v8c0 .6.4 1 1 1h10c.6 0 1-.4 1-1v-8c0-.6-.4-1-1-1zm-2.8 0H9.8V7c0-1.2 1-2.2 2.2-2.2s2.2 1 2.2 2.2v3z"})}),l=(0,t.jsx)(n.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,t.jsx)(n.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M5.5 12a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0ZM12 4a8 8 0 1 0 0 16 8 8 0 0 0 0-16Zm.75 4v1.5h-1.5V8h1.5Zm0 8v-5h-1.5v5h1.5Z"})}),s=window.wp.element,c=JSON.parse('{"UU":"vt-music-training/un-pupitre"}');(0,e.registerBlockType)(c.UU,{edit:function(e){const n=(0,i.useBlockProps)(),{context:c,attributes:u,setAttributes:h,clientId:d}=e,{"un-groupe-de-pupitres/cheminFichiers":p,"un-groupe-de-pupitres/typeFichiers":m,"un-groupe-de-pupitres/affichageClavier":v,"un-groupe-de-pupitres/fichierStereo":f}=c,{labelPupitre:x,nomFichier:w,cheminFichier:g,typeFichier:j,affichageClavier:b,fichierStereo:y}=u,[C,F]=(0,s.useState)(!1),[S,k]=(0,s.useState)(!1);g||h({cheminFichier:p}),j||h({typeFichier:m}),b||h({affichageClavier:v}),y||h({fichierStereo:f});const P=(0,s.useRef)(),[T,O]=(0,s.useState)(!1),[N,D]=(0,s.useState)(null),V=u.chaineFichiersPupitre?JSON.parse(u.chaineFichiersPupitre):[],[B,E]=(0,s.useState)(V);return(0,t.jsx)("div",{...n,children:e.isSelected?(0,t.jsxs)("div",{className:"vt--editor-un-pupitre",children:[(0,t.jsx)(r.TextControl,{label:"Label du pupitre",help:"Par ex. : S pour Soprano, A pour Alto...",value:x,onChange:e=>h({labelPupitre:e})}),(0,t.jsx)(r.TextControl,{label:"Chemin du fichier",value:g,onChange:e=>h({cheminFichier:e})}),(0,t.jsxs)(r.Flex,{align:"flex-end",style:{gap:"0.5em",marginBottom:"1em"},children:[(0,t.jsx)(r.FlexItem,{style:{flexGrow:1,position:"relative"},children:(0,t.jsx)(r.TextControl,{label:"Nom du fichier",value:w,readOnly:!C,onChange:e=>h({nomFichier:e})})}),(0,t.jsx)(r.FlexItem,{children:(0,t.jsx)(r.Tooltip,{text:C?"Verrouiller le champ":"Déverrouiller pour modifier",children:(0,t.jsx)(r.IconButton,{icon:C?o:a,label:C?"Verrouiller":"Déverrouiller",onClick:()=>F(!C),isPressed:C})})}),(0,t.jsx)(r.FlexItem,{children:(0,t.jsx)(r.Tooltip,{text:"Aide sur le nom de fichier",children:(0,t.jsx)(r.IconButton,{icon:l,label:"Information sur le nom du fichier",onClick:()=>k(!0),isTertiary:!0})})})]}),S&&(0,t.jsxs)(r.Modal,{title:"Aide sur le nom du fichier",onRequestClose:()=>k(!1),children:[(0,t.jsx)("p",{children:"Le nom du fichier est défini automatiquement après le téléchargement du fichier choisi. Dans la plupart des cas, il n’est pas nécessaire de le modifier."}),(0,t.jsx)("p",{children:"Cependant, vous pouvez exceptionnellement cliquer sur le cadenas pour déverrouiller le champ et saisir un nom personnalisé. (Par exemple, pour indiquer un fichier déjà téléchargé)."}),(0,t.jsx)("div",{style:{textAlign:"right",marginTop:"1em"},children:(0,t.jsx)(r.Button,{variant:"primary",onClick:()=>k(!1),children:"Fermer"})})]}),(0,t.jsxs)("div",{style:{marginTop:"1em"},children:[(0,t.jsx)("button",{type:"button",onClick:()=>P.current.click(),className:"components-button is-secondary",children:w?"Choisir un nouveau fichier":"Choisir un fichier"}),(0,t.jsx)("input",{type:"file",accept:"audio/*,video/*",ref:P,onChange:e=>(async e=>{const i=e.target.files[0];if(console.log(e.target),!i)return;O(!0),D(null);let r=w;try{if(r){console.log("suppression "+r);const e=await async function(e,i){if(!vtmtData||!vtmtData.nonce)throw new Error("Nonce manquant ou non injecté.");const r=new FormData;r.append("file",e),r.append("chemin",i);const n=await fetch("/wp-json/vt-music-training/v1/supprimer-fichier",{method:"POST",body:r,credentials:"include",headers:{"X-WP-Nonce":vtmtData.nonce}});if(!n.ok){const e=await n.json();throw new Error(e.message||"Erreur lors de la suppression du fichier précédent")}return await n.json()}(r,g);console.log(e.comment)}const e=await async function(e,i){if(!vtmtData||!vtmtData.nonce)throw new Error("Nonce manquant ou non injecté.");const r=new FormData;r.append("file",e),r.append("chemin",i);const n=await fetch("/wp-json/vt-music-training/v1/upload-fichier",{method:"POST",body:r,credentials:"include",headers:{"X-WP-Nonce":vtmtData.nonce}});if(!n.ok){const e=await n.json();throw new Error(e.message||"Erreur lors de l’upload")}return await n.json()}(i,g);console.log(e),h({nomFichier:e.nom}),console.log("Upload "+e.chemin+" - "+e.nom)}catch(e){console.error(e),O(!1)}finally{D(null),O(!1)}})(e),style:{display:"none"}})]}),T&&(0,t.jsx)("p",{children:"📤 Téléversement en cours..."}),N&&(0,t.jsxs)("p",{style:{color:"red"},children:["❌ ",N]}),w&&(0,t.jsxs)("div",{style:{marginTop:"1em",maxWidth:"250px"},children:[w.match(/\.(mp3|wav)$/i)&&(0,t.jsx)("audio",{controls:!0,src:`${window.location.origin}${g}/${w}`,children:"Votre navigateur ne supporte pas l’audio."}),w.match(/\.(mp4|webm)$/i)&&(0,t.jsx)("video",{controls:!0,src:`${window.location.origin}${g}/${w}`,children:"Votre navigateur ne supporte pas la vidéo."})]}),(0,t.jsx)(r.RadioControl,{label:"Type de fichier",selected:j,options:[{label:"audio",value:"a"},{label:"video",value:"v"}],onChange:e=>h({typeFichier:e})}),(0,t.jsx)(r.ToggleControl,{label:"Afficher le clavier sous le lecteur",checked:b,onChange:e=>h({affichageClavier:e})}),b&&(0,t.jsx)(r.ToggleControl,{label:"Le fichier est stéréo : la voix principale a une piste dédiée",checked:y,onChange:e=>h({fichierStereo:e})})]}):(0,t.jsx)("div",{className:"vt--pupitre-button","data-chemin":g,"data-nomfichier":w,"data-type":j,"data-clavier":b,"data-stereo":y,children:(0,t.jsxs)("div",{className:"vt--pupitre-label",children:[" ",x," "]})})})},save:function({attributes:e}){const r=i.useBlockProps.save(),{labelPupitre:n,cheminFichier:o,nomFichier:a,typeFichier:l,affichageClavier:s,fichierStereo:c}=e;return(0,t.jsx)("div",{...r,className:"vt--pupitre-button","data-chemin":o,"data-nomfichier":a,"data-type":l,"data-clavier":s,"data-stereo":c,children:(0,t.jsxs)("div",{className:"vt--pupitre-label",children:[" ",n," "]})})}})}},r={};function n(e){var t=r[e];if(void 0!==t)return t.exports;var o=r[e]={exports:{}};return i[e](o,o.exports,n),o.exports}n.m=i,e=[],n.O=(i,r,t,o)=>{if(!r){var a=1/0;for(u=0;u<e.length;u++){for(var[r,t,o]=e[u],l=!0,s=0;s<r.length;s++)(!1&o||a>=o)&&Object.keys(n.O).every(e=>n.O[e](r[s]))?r.splice(s--,1):(l=!1,o<a&&(a=o));if(l){e.splice(u--,1);var c=t();void 0!==c&&(i=c)}}return i}o=o||0;for(var u=e.length;u>0&&e[u-1][2]>o;u--)e[u]=e[u-1];e[u]=[r,t,o]},n.o=(e,i)=>Object.prototype.hasOwnProperty.call(e,i),(()=>{var e={7691:0,2803:0};n.O.j=i=>0===e[i];var i=(i,r)=>{var t,o,[a,l,s]=r,c=0;if(a.some(i=>0!==e[i])){for(t in l)n.o(l,t)&&(n.m[t]=l[t]);if(s)var u=s(n)}for(i&&i(r);c<a.length;c++)o=a[c],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return n.O(u)},r=globalThis.webpackChunkvt_music_training=globalThis.webpackChunkvt_music_training||[];r.forEach(i.bind(null,0)),r.push=i.bind(null,r.push.bind(r))})();var t=n.O(void 0,[2803],()=>n(598));t=n.O(t)})();